<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin=""/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
    integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
    crossorigin=""></script>
    <link href="https://fonts.googleapis.com/css?family=Bevan" rel="stylesheet">    
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/esri-leaflet@2.1.4/dist/esri-leaflet.js"
    integrity="sha512-m+BZ3OSlzGdYLqUBZt3u6eA0sH+Txdmq7cqA1u8/B2aTXviGMMLOfrKyiIW7181jbzZAY0u+3jWoiL61iLcTKQ=="
    crossorigin=""></script>
    <link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.2.9/dist/esri-leaflet-geocoder.css">
    <script src="https://unpkg.com/esri-leaflet-geocoder@2.2.8"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
    <script src="parks.js"></script>
    <title>[Park Experiences]</title>
</head>
<body>
    <div id="title"> <h2 class="p-1">Raleigh Park Experiences Lookup</h2></div>
    <div id="mapid"></div>

    <div class="form-group row">

        <div class="col-xs-4"><input type="text" id="filter" onkeyup="filter()" placeholder="Start typing a park to filter list..." title="Enter Park Name" class="form-control"></div>
        <ul id="button-container" class="justify-content-center text-center"></ul>
        </div>
<script>
    var myIcon = L.icon({
    iconUrl: 'geocode.png'
    });

    var mymap = L.map('mapid').setView([35.7877435, -78.644257], 13);
   
         

    L.tileLayer('https://api.mapbox.com/styles/v1/rmerino/cjg6xerpg1eux2sppksbbhp7a/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1Ijoicm1lcmlubyIsImEiOiJjamZpOHFzaGQwM2p5MzNtcXI5c251a2dlIn0.XRFhUVODMYz4Js_gIkO31g', {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
    maxZoom: 23,
    id: 'mapbox.streets',
    accessToken: 'your.mapbox.access.token'
    }).addTo(mymap);

    var searchControl = L.esri.Geocoding.geosearch().addTo(mymap);

    var results = L.layerGroup().addTo(mymap);

    var onEachFeature = function(feature, layer) {
        // Put jQuery function here to tie buttons to div
        newLink = $('<a>');
        newLink.text(layer.feature.properties.NAME)
                .attr('class','m-1')
                .attr('href','#')
                .attr('lat', layer.feature.geometry.coordinates[1])
                .attr('long', layer.feature.geometry.coordinates[0]);
        newUL = $('<li>');
        newUL.append(newLink);    
       $('#button-container').append(newUL);

       console.log(layer.feature);
    }

    var parks = L.esri.featureLayer({
    url:"https://services.arcgis.com/v400IkDOw1ad7Yad/arcgis/rest/services/ParksByExperiences/FeatureServer/0?token=dblfZriEdYILXMQiN-6EVMFXYNDLRddsqF-nas5Rzb_UquTD8rN1EUbckZZf4rlapOIqDeIViSKD2ORElxD_2UCQXdButaEXGiGvUjkZiU3-mXfAQuvhJrNk8peoB_CYs3U-S0LZeNGF8SDwqTPp9LxiX3SYlb_o7CXxjSdvu6hfHHjET24bmuCbI3YHPd59uEMBnFcopiEKfI3TCaFQ1ZGoQACjlkSl7srQcASKUrqxoNiMA6lLv64NFTxA6rGUzM2JcSt4UidGjKN_SdZrww..",
    onEachFeature: onEachFeature
    }).addTo(mymap);

    var popups = parks.bindPopup(function (layer) {
        return L.Util.template('<h4><strong>{NAME}</strong></h4><p>{ALL_AMENITIES}</p>', layer.feature.properties);
    });

    searchControl.on("results", function(data) {
        results.clearLayers();
        for (var i = data.results.length - 1; i >= 0; i--) {
            results.addLayer(L.marker(data.results[i].latlng,{icon: myIcon}));
        }
    });


function filter() {
    var input, filter, ul, li, a, i;
    input = document.getElementById("filter");
    filter = input.value.toUpperCase();
    ul = document.getElementById("button-container");
    li = ul.getElementsByTagName("li");
    for (i = 0; i < li.length; i++) {
        a = li[i].getElementsByTagName("a")[0];
        if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {
            li[i].style.display = "";
        } else {
            li[i].style.display = "none";

        }
    }
}

$('#button-container').on('click','a', function(){
    mymap.setView([$(this).attr('lat'),$(this).attr('long')],19);
    // add your table populations here
})


// Make empty table for yes/no - conditional coloring if yes or no
//In the onclick event, make a fading popup that says you can click on the marker for more information: http://jsfiddle.net/3XwZv/71/


</script>

</body>
</html>